const Web3 = require('web3');
const web3 = new Web3(new Web3.providers.WebsocketProvider("ws://localhost:8545"));

const DAI = "0x6B175474E89094C44Da98b954EedeAC495271d0F";
const USDC = "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48";
const USDT = "0xdAC17F958D2ee523a2206206994597C13D831ec7";

const FRAX = "0x853d955acef822db058eb8505911ed77f175b99e";
const crvUSDN = "0x4f3E8F405CF5aFC05D68142F3783bDfE13811522";
const crv3 = "0x6c3F90f043a72FA612cbac8115EE7e52BDe6E490";
const USDN = "0x674C6Ad92Fd080e4004b2312b45f796a192D27a0";

(async () => {
    let assetsArr = [DAI, USDC, USDT, FRAX, crvUSDN, crv3, USDN];
    let assetsBal = ['0', '1000000000', '1000000000', '1000000000000000000000', '1000000000000000000000', '1000000000000000000000', '1000000000000000000000']
    const assetMapping = new Map();

    [4, 5, 6].forEach(element => {
        assetMapping.set(assetsArr[element], assetsBal[element])
    })
    console.log(assetMapping)
    let dataParams = web3.eth.abi.encodeParameters(
        ['address[3]', 'uint256[3]', 'uint256', 'address[]', 'uint256[]'],
        [
            [DAI, USDC, USDT],
            ['0', '1000000000', '1000000000'],
            '1',
            [...assetMapping.keys()],
            [...assetMapping.values()]
        ]
    )
    console.log(dataParams)
});

(async () => {
    let withdrawInstructionBytes = web3.eth.abi.encodeFunctionCall({
        name: 'withdraw',
        type: 'function',
        inputs: [{
            type: 'uint256',
            name: '_shares'
        }, {
            type: 'address',
            name: '_withrawalAsset'
        }
        ]
    }, ["3000000000000000000000", "0x674C6Ad92Fd080e4004b2312b45f796a192D27a0"])
    console.log("Instruction \n", withdrawInstructionBytes)
})()

/**
 let vault = await YieldsterVault.at("0xCEC4EB6db417C0D9B287cba0Bc34cdfE0d7d861E")
 let strategy = await ConvexCRV.at("0xd5147E19723fa46B97977848ff4DA0d3f4bdAbc0")
 let minter = await ConvexCRVMinter.at("0x45805aD1640D19F8fc509FBDCA77125df0aF8363")
 await minter.earn(vault.address,["0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48","0xdAC17F958D2ee523a2206206994597C13D831ec7","0x4f3E8F405CF5aFC05D68142F3783bDfE13811522","0x6c3F90f043a72FA612cbac8115EE7e52BDe6E490","0x674C6Ad92Fd080e4004b2312b45f796a192D27a0"],["1000000000","1000000000","1000000000000000000000","1000000000000000000000","1000000000000000000000"],"0x0000000000000000000000006b175474e89094c44da98b954eedeac495271d0f000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000000000000000000000000dac17f958d2ee523a2206206994597c13d831ec70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b9aca00000000000000000000000000000000000000000000000000000000003b9aca000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000000030000000000000000000000004f3e8f405cf5afc05d68142f3783bdfe138115220000000000000000000000006c3f90f043a72fa612cbac8115ee7e52bde6e490000000000000000000000000674c6ad92fd080e4004b2312b45f796a192d27a0000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000003635c9adc5dea0000000000000000000000000000000000000000000000000003635c9adc5dea0000000000000000000000000000000000000000000000000003635c9adc5dea00000")

await minter.mintStrategy(vault.address,"0x00f714ce0000000000000000000000000000000000000000000000a2a15d09519be00000000000000000000000000000674c6ad92fd080e4004b2312b45f796a192d27a0")

 Map {
  '0x4f3E8F405CF5aFC05D68142F3783bDfE13811522' => '1000000000000000000000',
  '0x6c3F90f043a72FA612cbac8115EE7e52BDe6E490' => '1000000000000000000000',
  '0x674C6Ad92Fd080e4004b2312b45f796a192D27a0' => '1000000000000000000000'
}

await strategy.setSlippage(5000)
await strategy.setSlippageSwap(5000)

(await vault.getVaultNAV()).toString() / (10**18) //60536.16778159273
(await vault.getVaultNAVWithoutStrategyToken()).toString() / (10**18) //55447.60432576829
(await strategy.getConvexBalance()).toString() /(10**18) //4877.295248836418

 (await usdn.balanceOf(vault.address)).toString() /(10**18)
*/